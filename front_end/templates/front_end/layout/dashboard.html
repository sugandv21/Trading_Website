{% extends "front_end/layout/base.html" %}
{% load static %}

{% block extra_css %}
<style>
  body { background: #0f1720; color:#111; }
  .sidebar { width:260px; background:#2f3436; border-top-right-radius:1rem; border-bottom-right-radius:1rem; }
  .sidebar .nav-link { color:#dfe8e7; }
  .sidebar .nav-link.active { color:#d8ff73; }
  .kpi-card { background:#2a2f30; border-radius:14px; }
  .kpi-value { color:#d8ff73; font-weight:700; font-size:1.25rem; }
  .chart-card { background:#1f2627; border-radius:18px; }
  .widget { background:#2a2f30; border-radius:12px; }
  .avatar-placeholder {
    width:80px; height:80px; border-radius:50%;
    background:#ffb86b; display:flex; align-items:center; justify-content:center;
    font-weight:700; color:#111; font-size:1.2rem; border:4px solid #2f3436;
  }
</style>
{% endblock %}

{% block content %}
<div class="d-flex min-vh-100 text-light">
  <!-- Sidebar -->
  <aside class="sidebar p-3 d-flex flex-column">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div class="d-flex align-items-center">
        <div class="rounded-circle bg-gradient p-2 text-white fw-bold me-2">HT</div>
        <div>
          <div class="fw-semibold">Hiima Trading</div>
          <div class="small text-muted">Group</div>
        </div>
      </div>
      <button class="btn btn-sm btn-outline-light"><i class="bi bi-list"></i></button>
    </div>

    <!-- Profile -->
    <div class="text-center mb-4">
      <div class="position-relative d-inline-block">
        {# Prefer avatar_url from view if provided; fallback to user.profile.avatar if exists; otherwise placeholder initial #}
        {% if avatar_url %}
          <img src="{{ avatar_url }}" alt="avatar" class="rounded-circle border border-4 border-secondary" style="width:80px;height:80px;">
        {% else %}
          {% with user.get_full_name|default:user.username as name %}
            {% if user and user|default_if_none:"" and user.profile and user.profile.avatar %}
              <img src="{{ user.profile.avatar.url }}" alt="avatar" class="rounded-circle border border-4 border-secondary" style="width:80px;height:80px;">
            {% else %}
              <div class="avatar-placeholder">{{ name|first|upper }}</div>
            {% endif %}
          {% endwith %}
        {% endif %}
        <div class="position-absolute top-0 end-0 bg-dark border border-secondary rounded-circle p-1">
          <i class="bi bi-gear"></i>
        </div>
      </div>
      <div class="mt-2">
        <div class="fw-semibold">{{ user.get_full_name|default:"Hello John" }}</div>
        <div class="small text-muted">{{ user.email|default:"johnbenando.gmail.in" }}</div>
      </div>
    </div>

    <!-- Menu -->
    <nav class="nav flex-column">
      <a class="nav-link active" href="#"><i class="bi bi-grid"></i> Dashboard</a>
      <a class="nav-link" href="#"><i class="bi bi-house"></i> Live Trading Room</a>

      <div class="nav-item">
        <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#tradingTools">
          <span><i class="bi bi-tools"></i> Trading Tools</span>
          <i class="bi bi-chevron-down"></i>
        </a>
        <div class="collapse ps-4" id="tradingTools">
          <a class="nav-link" href="#">FX Calculator</a>
          <a class="nav-link" href="#">News Calendar</a>
        </div>
      </div>

      <div class="nav-item">
        <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#eliteTools">
          <span><i class="bi bi-people"></i> Elite Trader Tools</span>
          <i class="bi bi-chevron-down"></i>
        </a>
        <div class="collapse ps-4" id="eliteTools">
          <a class="nav-link" href="#">Market Analysis</a>
          <a class="nav-link" href="#">Trading Central Plug in</a>
          <a class="nav-link" href="#">Auto Trendline Plug in</a>
          <a class="nav-link" href="#">Support/Residence Plt</a>
        </div>
      </div>

      <a class="nav-link" href="#"><i class="bi bi-person"></i> Mentorship</a>
      <a class="nav-link" href="#"><i class="bi bi-calendar"></i> Book a Meeting</a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-grow-1 p-4">
    <div class="d-flex justify-content-between align-items-start mb-4">
      <div>
        <div class="small text-muted">Account 123456</div>
        <div class="d-flex align-items-center">
          <span class="badge bg-success rounded-circle me-2">&nbsp;</span>
          <span class="small">Active</span>
        </div>
      </div>
      <div class="d-flex align-items-center">
        <span class="text-muted me-3">Evaluation $15,000</span>
        <button class="btn btn-outline-light btn-sm rounded-pill">RESET</button>
      </div>
    </div>

    <!-- KPI Cards -->
    <div class="row g-3 mb-4">
      {% for kpi in admin_content.kpis %}
      <div class="col-md-3">
        <div class="kpi-card p-3 h-100">
          <div class="d-flex justify-content-between">
            <div class="rounded-circle bg-success p-2">ðŸ“Š</div>
            <div>?</div>
          </div>
          <div class="mt-3 small text-muted">{{ kpi.title }}</div>
          <div class="kpi-value">{{ kpi.value }}</div>
          <div class="small text-muted">{{ kpi.subtitle }}</div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Chart and Right Widgets -->
    <div class="row g-3">
      <div class="col-lg-8">
        <div class="chart-card p-3">
          <div class="d-flex justify-content-between mb-3">
            <div>
              <div class="text-success fw-semibold">{{ admin_content.chart.title }}</div>
              <div class="small text-muted">{{ admin_content.chart.subtitle }}</div>
            </div>
            <select class="form-select form-select-sm bg-dark text-light border-light" style="width:auto;">
              <option>Year</option>
              <option>Month</option>
            </select>
          </div>
          <div class="bg-secondary rounded p-5 text-center">[Chart Placeholder]</div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="widget p-3 mb-3">
          <div class="fw-semibold mb-2">Drawdown</div>
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-dark p-4 me-3">{{ admin_content.right_widgets.drawdown.0 }}%</div>
            <div>
              <div class="small text-muted">Of Your Balance Left</div>
              <div>{{ admin_content.right_widgets.drawdown.0 }}%</div>
            </div>
          </div>
        </div>

        <div class="widget p-3">
          <div class="fw-semibold mb-2">Goals</div>
          <div class="small">${{ admin_content.right_widgets.goals.0 }} Out Of $10,000</div>
          <div class="small">{{ admin_content.right_widgets.goals.1 }} Trading Days out of 30 Days</div>
        </div>
      </div>
    </div>
  </main>
</div>
{% endblock %}
